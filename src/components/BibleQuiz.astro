---
// src/components/BibleQuiz.astro
// La pregunta rota automÃ¡ticamente cada semana segÃºn el nÃºmero de semana del aÃ±o.
---

<div class="glass-card p-8 rounded-3xl border-brand-success/30 max-w-2xl mx-auto my-12 relative overflow-hidden group animate-glow-success">
    <div class="absolute -top-12 -right-12 w-32 h-32 bg-brand-success/10 blur-3xl rounded-full"></div>
    
    <div class="relative z-10">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-black text-white tracking-tight">Trivia <span class="text-brand-success">BÃ­blica</span></h3>
            <span id="quiz-week-badge" class="bg-brand-success/20 text-brand-success text-[10px] font-black px-2 py-1 rounded uppercase tracking-widest">Semanal</span>
        </div>

        <div id="quiz-content">
            <p id="question" class="text-lg text-slate-200 font-medium mb-8 leading-relaxed">Cargando pregunta...</p>

            <div id="options-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <!-- Options rendered by JS -->
            </div>
        </div>

        <div id="quiz-result" class="hidden text-center py-6">
            <div id="result-icon" class="text-4xl mb-4">ğŸ‰</div>
            <h4 id="result-title" class="text-xl font-black text-white mb-2">Â¡Correcto!</h4>
            <p id="result-desc" class="text-slate-400 text-sm mb-6"></p>
            <button id="reset-quiz" class="text-[10px] font-black text-brand-success hover:text-white transition-colors uppercase tracking-[0.2em]">Intentar de nuevo</button>
        </div>
    </div>
</div>

<script>
    const PREGUNTAS = [
        {
            pregunta: "Â¿QuiÃ©n fue el primer rey de Israel?",
            opciones: ["David", "SaÃºl", "SalomÃ³n", "Samuel"],
            correcta: 1,
            explicacion: "SaÃºl fue ungido por el profeta Samuel como el primer rey de Israel. (1 Samuel 10:1)"
        },
        {
            pregunta: "Â¿CuÃ¡ntos dÃ­as estuvo JonÃ¡s en el vientre del gran pez?",
            opciones: ["1 dÃ­a", "3 dÃ­as", "7 dÃ­as", "40 dÃ­as"],
            correcta: 1,
            explicacion: "JonÃ¡s estuvo tres dÃ­as y tres noches en el vientre del pez. (JonÃ¡s 1:17)"
        },
        {
            pregunta: "Â¿QuiÃ©n escribiÃ³ la mayorÃ­a de los Salmos?",
            opciones: ["MoisÃ©s", "SalomÃ³n", "David", "Asaf"],
            correcta: 2,
            explicacion: "La mayorÃ­a de los 150 salmos son atribuidos al rey David."
        },
        {
            pregunta: "Â¿Con quÃ© alimento multiplicÃ³ JesÃºs los panes para la multitud?",
            opciones: ["Trigo y aceite", "5 panes y 2 peces", "ManÃ¡ del cielo", "7 panes y 3 peces"],
            correcta: 1,
            explicacion: "JesÃºs tomÃ³ 5 panes y 2 peces y alimentÃ³ a mÃ¡s de 5.000 personas. (Juan 6:9-11)"
        },
        {
            pregunta: "Â¿CuÃ¡ntos apÃ³stoles eligiÃ³ JesÃºs?",
            opciones: ["7", "10", "12", "70"],
            correcta: 2,
            explicacion: "JesÃºs eligiÃ³ a 12 apÃ³stoles para que estuvieran con Ã©l y los enviara a predicar. (Marcos 3:14)"
        },
        {
            pregunta: "Â¿QuÃ© rÃ­o cruzÃ³ JesÃºs cuando fue bautizado?",
            opciones: ["El Nilo", "El Ã‰ufrates", "El JordÃ¡n", "El Mar de Galilea"],
            correcta: 2,
            explicacion: "JesÃºs fue bautizado por Juan en el rÃ­o JordÃ¡n. (Marcos 1:9)"
        },
        {
            pregunta: "Â¿En quÃ© ciudad naciÃ³ JesÃºs?",
            opciones: ["Nazaret", "JerusalÃ©n", "BelÃ©n", "JericÃ³"],
            correcta: 2,
            explicacion: "JesÃºs naciÃ³ en BelÃ©n de Judea, segÃºn lo anunciado por los profetas. (Mateo 2:1)"
        },
        {
            pregunta: "Â¿QuiÃ©n traicionÃ³ a JesÃºs por 30 monedas de plata?",
            opciones: ["Pedro", "TomÃ¡s", "Judas Iscariote", "Nicodemo"],
            correcta: 2,
            explicacion: "Judas Iscariote traicionÃ³ a JesÃºs entregÃ¡ndolo a los sumos sacerdotes. (Mateo 26:15)"
        },
        {
            pregunta: "Â¿CuÃ¡l fue el primer milagro de JesÃºs?",
            opciones: ["SanÃ³ a un ciego", "ConvirtiÃ³ agua en vino", "AlimentÃ³ a 5.000", "CaminÃ³ sobre el agua"],
            correcta: 1,
            explicacion: "En las bodas de CanÃ¡, JesÃºs convirtiÃ³ el agua en vino. (Juan 2:1-11)"
        },
        {
            pregunta: "Â¿QuiÃ©n escribiÃ³ el libro de Apocalipsis?",
            opciones: ["Pablo", "Pedro", "Juan", "Lucas"],
            correcta: 2,
            explicacion: "El apÃ³stol Juan escribiÃ³ el libro de Apocalipsis estando en la isla de Patmos. (Apocalipsis 1:9)"
        },
        {
            pregunta: "Â¿A quÃ© Ã¡rbol se subiÃ³ Zaqueo para ver a JesÃºs?",
            opciones: ["Olivo", "Higuera", "Sicomoro", "Cedro"],
            correcta: 2,
            explicacion: "Zaqueo, siendo pequeÃ±o de estatura, se subiÃ³ a un Ã¡rbol sicomoro para ver a JesÃºs. (Lucas 19:4)"
        },
        {
            pregunta: "Â¿CuÃ¡ntos libros tiene el Nuevo Testamento?",
            opciones: ["22", "27", "33", "39"],
            correcta: 1,
            explicacion: "El Nuevo Testamento tiene 27 libros, desde Mateo hasta Apocalipsis."
        },
        {
            pregunta: "Â¿QuÃ© versÃ­culo dice: 'Porque de tal manera amÃ³ Dios al mundo'?",
            opciones: ["Romanos 8:28", "Salmo 23:1", "Juan 3:16", "Filipenses 4:13"],
            correcta: 2,
            explicacion: "Juan 3:16 dice: 'Porque de tal manera amÃ³ Dios al mundo, que ha dado a su Hijo unigÃ©nito...'"
        },
        {
            pregunta: "Â¿CuÃ¡ntos dÃ­as tardÃ³ Dios en crear el mundo segÃºn GÃ©nesis?",
            opciones: ["5 dÃ­as", "6 dÃ­as", "7 dÃ­as", "10 dÃ­as"],
            correcta: 1,
            explicacion: "Dios creÃ³ el mundo en 6 dÃ­as y descansÃ³ el sÃ©ptimo. (GÃ©nesis 1-2)"
        },
        {
            pregunta: "Â¿QuiÃ©n fue llevado al cielo en un carro de fuego?",
            opciones: ["MoisÃ©s", "ElÃ­as", "Enoc", "IsaÃ­as"],
            correcta: 1,
            explicacion: "El profeta ElÃ­as fue llevado al cielo en un torbellino en un carro de fuego. (2 Reyes 2:11)"
        },
        {
            pregunta: "Â¿CuÃ¡l es el versÃ­culo mÃ¡s corto de la Biblia?",
            opciones: ["'Dios es amor.'", "'JesÃºs llorÃ³.'", "'Orad sin cesar.'", "'Aleluya.'"],
            correcta: 1,
            explicacion: "'JesÃºs llorÃ³.' (Juan 11:35) es ampliamente reconocido como el versÃ­culo mÃ¡s corto de la Biblia."
        },
        {
            pregunta: "Â¿QuiÃ©n construyÃ³ el arca segÃºn la Biblia?",
            opciones: ["Abraham", "NoÃ©", "MoisÃ©s", "Sem"],
            correcta: 1,
            explicacion: "Dios instruyÃ³ a NoÃ© para que construyera el arca para salvar a su familia y a los animales. (GÃ©nesis 6:14)"
        },
        {
            pregunta: "Â¿En quÃ© lago predicÃ³ JesÃºs desde una barca?",
            opciones: ["Lago TiberÃ­ades (Galilea)", "Mar de la Sal", "Lago de Siria", "Mar Rojo"],
            correcta: 0,
            explicacion: "JesÃºs predicÃ³ desde una barca en el lago de TiberÃ­ades (Mar de Galilea). (Lucas 5:3)"
        },
        {
            pregunta: "Â¿CuÃ¡ntas cartas escribiÃ³ Pablo que estÃ¡n en el Nuevo Testamento?",
            opciones: ["9", "11", "13", "15"],
            correcta: 2,
            explicacion: "Se atribuyen 13 cartas al apÃ³stol Pablo en el Nuevo Testamento, desde Romanos hasta FilemÃ³n."
        },
        {
            pregunta: "Â¿QuiÃ©n dijo: 'No sean conformados a este siglo'?",
            opciones: ["JesÃºs", "Pablo", "Pedro", "Santiago"],
            correcta: 1,
            explicacion: "Pablo escribiÃ³ 'No os conformÃ©is a este siglo' en Romanos 12:2."
        },
    ];

    function getWeekNumber(date: Date): number {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d.getTime() - yearStart.getTime()) / 86400000) + 1) / 7);
    }

    const semana = getWeekNumber(new Date());
    const preguntaIndex = semana % PREGUNTAS.length;
    const preguntaActual = PREGUNTAS[preguntaIndex];

    // Render question
    const questionEl = document.getElementById('question');
    const badgeEl = document.getElementById('quiz-week-badge');
    const optionsGrid = document.getElementById('options-grid');

    if (questionEl) questionEl.textContent = preguntaActual.pregunta;
    if (badgeEl) badgeEl.textContent = `Semana ${semana}`;

    if (optionsGrid) {
        optionsGrid.innerHTML = preguntaActual.opciones.map((op, i) => `
            <button
                class="quiz-option glass-card hover:bg-white/10 p-4 rounded-xl text-left text-sm text-slate-300 transition-all border-white/5 hover:border-brand-success/50"
                data-correct="${i === preguntaActual.correcta}"
            >${op}</button>
        `).join('');
    }

    // Attach listeners
    const content = document.getElementById('quiz-content');
    const result = document.getElementById('quiz-result');
    const titleEl = document.getElementById('result-title');
    const descEl = document.getElementById('result-desc');
    const iconEl = document.getElementById('result-icon');
    const resetBtn = document.getElementById('reset-quiz');

    document.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => {
            const isCorrect = btn.getAttribute('data-correct') === 'true';

            if (content && result && titleEl && descEl && iconEl) {
                content.classList.add('hidden');
                result.classList.remove('hidden');

                if (isCorrect) {
                    titleEl.textContent = 'Â¡Correcto! ğŸ‰';
                    titleEl.className = 'text-xl font-black text-brand-success mb-2';
                    iconEl.textContent = 'ğŸ‰';
                    descEl.textContent = preguntaActual.explicacion;
                } else {
                    titleEl.textContent = 'Â¡Casi!';
                    titleEl.className = 'text-xl font-black text-red-400 mb-2';
                    iconEl.textContent = 'ğŸ“–';
                    descEl.textContent = preguntaActual.explicacion;
                }
            }
        });
    });

    resetBtn?.addEventListener('click', () => {
        if (content && result) {
            result.classList.add('hidden');
            content.classList.remove('hidden');
        }
    });
</script>
