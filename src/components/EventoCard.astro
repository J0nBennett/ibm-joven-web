---
interface Props {
  id: string;
  titulo: string;
  fecha: string;
  hora: string;
  lugar: string;
  descripcion_md: string; // Using the raw MD as description for now or a snippet
  className?: string;
}

const { id, titulo, fecha, hora, lugar, descripcion_md, className = "" } = Astro.props;

const fechaObj = new Date(fecha + 'T12:00:00'); // Force noon to avoid timezone shifts on simple dates
const dia = fechaObj.getDate();
const mes = fechaObj.toLocaleDateString('es-AR', { month: 'short' }).toUpperCase();
---

<article class={`flex flex-col sm:flex-row bg-gradient-to-br from-slate-900 to-blue-900 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border border-slate-700/50 ${className}`}>
  <!-- Date Badge -->
  <div class="bg-blue-900/50 sm:w-24 p-4 flex flex-row sm:flex-col items-center justify-center gap-2 sm:gap-0 border-b sm:border-b-0 sm:border-r border-slate-700/50 text-blue-200">
    <span class="text-3xl font-bold leading-none">{dia}</span>
    <span class="text-sm font-bold tracking-wider uppercase">{mes}</span>
  </div>
  
  <div class="p-6 flex-grow flex flex-col">
    <div class="mb-4">
        <h3 class="text-2xl font-bold text-white leading-tight mb-2">{titulo}</h3>
        
        <div class="flex flex-wrap text-sm text-slate-300 gap-x-6 gap-y-2">
        <div class="flex items-center">
            <span class="mr-2 text-blue-400">üïí</span> {hora} hs
        </div>
        <div class="flex items-center">
            <span class="mr-2 text-red-400">üìç</span> {lugar}
        </div>
        </div>
    </div>
    
    <p class="text-slate-200 text-sm line-clamp-2 leading-relaxed mb-6">
        {descripcion_md.replace(/[*_#]/g, '')}
    </p>

    {/* Calendar Button Logic */}
    {
      (() => {
        const formatDate = (dateStr: string, timeStr: string) => {
            const d = new Date(`${dateStr}T${timeStr}:00`);
            const end = new Date(d.getTime() + 2 * 60 * 60 * 1000); 
            const format = (date: Date) => date.toISOString().replace(/-|:|\.\d\d\d/g, "");
            return { start: format(d), end: format(end) };
        };
        
        const { start, end } = formatDate(fecha, hora);
        const gCalUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(titulo + " - IBM Joven")}&dates=${start}/${end}&details=${encodeURIComponent(descripcion_md)}&location=${encodeURIComponent(lugar)}`;
    
        return (
            <div class="mt-auto flex justify-end">
                <a 
                    href={gCalUrl} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="inline-flex items-center text-sm font-semibold text-white bg-blue-600 hover:bg-blue-500 px-5 py-2.5 rounded-lg transition-all shadow-md hover:shadow-blue-500/30 border border-blue-500"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11v6m0 0l-3-3m3 3l3-3" />
                    </svg>
                    Agendar
                </a>
            </div>
        );
      })()
    }
  </div>
</article>
