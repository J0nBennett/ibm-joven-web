---
import Layout from '../layouts/Layout.astro';
import AnuncioCard from '../components/AnuncioCard.astro';
import EventoCard from '../components/EventoCard.astro';

// Import data (using fs to read from public/data generated by sync script)
import fs from 'node:fs/promises';
import path from 'node:path';

let anuncios = [];
let eventos = [];

try {
  const anunciosPath = path.join(process.cwd(), 'public', 'data', 'anuncios.json');
  const eventosPath = path.join(process.cwd(), 'public', 'data', 'eventos.json');
  
  const anunciosData = await fs.readFile(anunciosPath, 'utf-8');
  const eventosData = await fs.readFile(eventosPath, 'utf-8');
  
  anuncios = JSON.parse(anunciosData);
  eventos = JSON.parse(eventosData);
} catch (e) {
  console.error("Error loading data:", e);
  // Fail gracefully or show empty state
}

const ultimoAnuncio = anuncios.length > 0 ? anuncios[0] : null;
const proximosEventos = eventos.slice(0, 3);
---

<Layout title="IBM Joven - Inicio">
  <section class="mb-12 text-center py-10 bg-gradient-to-r from-blue-900 to-blue-800 text-white rounded-2xl shadow-xl">
    <h1 class="text-4xl md:text-5xl font-bold mb-4 tracking-tight">Bienvenido a IBM Joven</h1>
    <p class="text-xl text-blue-100 max-w-2xl mx-auto">Comunidad de jóvenes de la Iglesia Bautista Maranata based en la fe, el servicio y la amistad.</p>
    <div class="mt-8 flex justify-center gap-4">
        <a href="/nosotros" class="bg-white text-blue-900 hover:bg-blue-50 px-6 py-3 rounded-full font-semibold transition shadow-md">Conócenos</a>
        <a href="/contacto" class="bg-blue-700 text-white hover:bg-blue-600 px-6 py-3 rounded-full font-semibold transition border border-blue-500">Contactanos</a>
    </div>
  </section>

  <div class="grid lg:grid-cols-2 gap-12">
    <!-- Section: Ultimo Anuncio -->
    <section>
      <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-blue-500 pl-3">Último Anuncio</h2>
          <a href="/anuncios" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Ver todos &rarr;</a>
      </div>
      
      {ultimoAnuncio ? (
        <AnuncioCard 
          id={ultimoAnuncio.id}
          titulo={ultimoAnuncio.titulo}
          fecha={ultimoAnuncio.fecha}
          categoria={ultimoAnuncio.categoria}
          resumen={ultimoAnuncio.resumen}
          className="h-full border-l-4 border-l-blue-500"
        />
      ) : (
        <div class="bg-white p-8 rounded-lg shadow-sm border border-gray-100 text-center">
            <p class="text-gray-500 italic">No hay anuncios destacados por el momento.</p>
        </div>
      )}
    </section>

    <!-- Section: Proximos Eventos -->
    <section>
      <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-green-500 pl-3">Próximos Eventos</h2>
          <a href="/eventos" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Ver calendario &rarr;</a>
      </div>

      <div class="space-y-4">
        {proximosEventos.length > 0 ? (
          proximosEventos.map(evento => (
            <EventoCard 
              id={evento.id}
              titulo={evento.titulo}
              fecha={evento.fecha}
              hora={evento.hora}
              lugar={evento.lugar}
              descripcion_md={evento.descripcion_md}
            />
          ))
        ) : (
             <div class="bg-white p-8 rounded-lg shadow-sm border border-gray-100 text-center">
                <p class="text-gray-500 italic">No hay próximos eventos cargados.</p>
            </div>
        )}
      </div>
    </section>
  </div>
</Layout>
