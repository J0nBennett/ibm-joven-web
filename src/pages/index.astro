---
import Layout from '../layouts/Layout.astro';
import AnuncioCard from '../components/AnuncioCard.astro';
import EventoCard from '../components/EventoCard.astro';

const base = import.meta.env.BASE_URL;

// Import data (using fs to read from public/data generated by sync script)
import fs from 'node:fs/promises';
import path from 'node:path';

let anuncios = [];
let eventos = [];

try {
  const anunciosPath = path.join(process.cwd(), 'public', 'data', 'anuncios.json');
  const eventosPath = path.join(process.cwd(), 'public', 'data', 'eventos.json');
  
  const anunciosData = await fs.readFile(anunciosPath, 'utf-8');
  const eventosData = await fs.readFile(eventosPath, 'utf-8');
  
  anuncios = JSON.parse(anunciosData);
  eventos = JSON.parse(eventosData);
} catch (e) {
  console.error("Error loading data:", e);
  // Fail gracefully or show empty state
}

const ultimoAnuncio = anuncios.length > 0 ? anuncios[0] : null;
const proximosEventos = eventos.slice(0, 3);
---

<Layout title="IBM Joven - Inicio" description="Bienvenido a IBM Joven, el ministerio de jóvenes de la Iglesia Bautista Maranata en Luque, Paraguay. Fe, servicio y amistad.">
  <section class="mb-12 text-center py-16 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white rounded-2xl shadow-2xl relative overflow-hidden">
    <div class="absolute inset-0 opacity-10 bg-[url('/grid.svg')]"></div> <!-- Optional texture placeholder -->
    <div class="relative z-10">
        <h1 class="text-4xl md:text-6xl font-extrabold mb-6 tracking-tight leading-tight">
            Bienvenido a <span class="text-blue-400">IBM Joven</span>
        </h1>
        <p class="text-xl md:text-2xl text-slate-200 max-w-2xl mx-auto mb-10 font-light">
            Comunidad de jóvenes de la Iglesia Bautista Maranata basada en la fe, el servicio y la amistad.
        </p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <a href={`${base}nosotros`} class="bg-white text-slate-900 hover:bg-blue-50 px-8 py-4 rounded-full font-bold transition shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                Conócenos
            </a>
            <a href={`${base}contacto`} class="bg-blue-600 text-white hover:bg-blue-500 px-8 py-4 rounded-full font-bold transition shadow-lg hover:shadow-xl border border-blue-500 transform hover:-translate-y-1">
                Contactanos
            </a>
        </div>
    </div>
  </section>

  <div class="grid lg:grid-cols-2 gap-12 mb-24 pb-12">
    <!-- Section: Ultimo Anuncio -->
    <section>
      <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-blue-500 pl-3">Último Anuncio</h2>
          <a href={`${base}anuncios`} class="text-blue-600 hover:text-blue-800 text-sm font-medium">Ver todos &rarr;</a>
      </div>
      
      {ultimoAnuncio ? (
        <AnuncioCard
          id={ultimoAnuncio.id}
          titulo={ultimoAnuncio.titulo}
          fecha={ultimoAnuncio.fecha}
          categoria={ultimoAnuncio.categoria}
          resumen={ultimoAnuncio.resumen}
          contenido_md={ultimoAnuncio.contenido_md}
          className="h-full border-l-4 border-l-blue-500"
        />
      ) : (
        <div class="bg-white p-8 rounded-lg shadow-sm border border-gray-100 text-center">
            <p class="text-gray-500 italic">No hay anuncios destacados por el momento.</p>
        </div>
      )}
    </section>

    <!-- Section: Proximos Eventos -->
    <section>
      <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800 border-l-4 border-green-500 pl-3">Próximos Eventos</h2>
          <a href={`${base}eventos`} class="text-blue-600 hover:text-blue-800 text-sm font-medium">Ver calendario &rarr;</a>
      </div>

      <div class="space-y-4">
        {proximosEventos.length > 0 ? (
          proximosEventos.map(evento => (
            <EventoCard 
              id={evento.id}
              titulo={evento.titulo}
              fecha={evento.fecha}
              hora={evento.hora}
              lugar={evento.lugar}
              descripcion_md={evento.descripcion_md}
            />
          ))
        ) : (
             <div class="bg-white p-8 rounded-lg shadow-sm border border-gray-100 text-center">
                <p class="text-gray-500 italic">No hay próximos eventos cargados.</p>
            </div>
        )}
      </div>
    </section>
  </div>
</Layout>
